<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026 RIA & í™˜í—¤ì§€ ì ˆì„¸ ê³„ì‚°ê¸° (ìƒì„¸ì‚°ì‹ í¬í•¨)</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --primary: #0b7285; --bg: #f8f9fa; --text: #343a40; }
        body { font-family: 'Pretendard', -apple-system, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 10px; }
        .container { max-width: 600px; margin: 0 auto; background: #fff; padding: 30px; border-radius: 16px; box-shadow: 0 4px 20px rgba(0,0,0,0.06); }
        h2 { text-align: center; color: var(--primary); margin-top: 0; margin-bottom: 20px; font-size: 1.4rem; letter-spacing: -0.5px; }
        .badge { background: #e3fafc; color: #0c8599; padding: 3px 6px; border-radius: 4px; font-size: 0.75rem; font-weight: bold; vertical-align: middle; margin-left: 5px; }
        
        .section-title { font-size: 0.95rem; font-weight: bold; color: #495057; margin-top: 25px; margin-bottom: 10px; border-bottom: 2px solid #f1f3f5; padding-bottom: 5px; }
        
        .input-group { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px; }
        .full-width { grid-column: span 2; }
        
        label { font-weight: 600; font-size: 0.85rem; margin-bottom: 6px; display: block; color: #495057; }
        input, select { width: 100%; padding: 12px; border: 1px solid #dee2e6; border-radius: 8px; font-size: 1rem; box-sizing: border-box; transition: border-color 0.2s; background: #fff; }
        input:focus, select:focus { outline: none; border-color: var(--primary); }
        
        button { width: 100%; padding: 16px; background: var(--primary); color: #fff; border: none; border-radius: 10px; font-size: 1.1rem; font-weight: bold; cursor: pointer; margin-top: 15px; transition: background 0.2s; }
        button:hover { background: #085f6e; }
        
        /* ê²°ê³¼ ë°•ìŠ¤ ìŠ¤íƒ€ì¼ */
        .result-box { margin-top: 30px; padding: 25px; background: #e3fafc; border-radius: 12px; text-align: center; display: none; border: 1px solid #c5f6fa; }
        .result-val { font-size: 2rem; font-weight: 800; color: #0b7285; margin: 10px 0 10px 0; }
        
        /* ìƒì„¸ ì‚°ì‹ ìŠ¤íƒ€ì¼ (NEW) */
        .calc-detail { background: #f8f9fa; border: 1px dashed #ced4da; border-radius: 8px; padding: 15px; margin-top: 20px; text-align: left; font-size: 0.9rem; display: none; }
        .calc-step { margin-bottom: 12px; padding-bottom: 12px; border-bottom: 1px solid #eee; }
        .calc-step:last-child { border-bottom: none; margin-bottom: 0; padding-bottom: 0; }
        .step-title { font-weight: bold; color: #495057; margin-bottom: 4px; display: block; }
        .step-formula { color: #868e96; font-size: 0.85rem; font-family: monospace; background: #fff; padding: 4px; border-radius: 4px; display: block; margin-top: 3px; }
        .step-result { float: right; font-weight: bold; color: #0b7285; }

        .chart-area { margin-top: 25px; position: relative; height: 250px; display: none; }
        .footer { font-size: 0.75rem; color: #868e96; margin-top: 30px; line-height: 1.4; background: #f8f9fa; padding: 10px; border-radius: 8px; }
    </style>
</head>
<body>

<div class="container">
    <h2>ğŸ‡°ğŸ‡· 2026 RIA & í™˜í—¤ì§€ ì ˆì„¸ ê³„ì‚°ê¸°</h2>
    
    <div class="section-title">1. íˆ¬ì ì •ë³´ ì…ë ¥</div>
    <div class="input-group">
        <div><label>íˆ¬ì ì›ê¸ˆ (ë§Œì›)</label><input type="number" id="principal" value="5000"></div>
        <div><label>ì´ ìˆ˜ìµê¸ˆ (ë§Œì›)</label><input type="number" id="profit" value="2000"></div>
    </div>

    <div class="section-title">2. RIA (êµ­ë‚´ë³µê·€) ì‹œì  <span class="badge">í•µì‹¬</span></div>
    <div class="full-width">
        <select id="riaTiming">
            <option value="0" data-text="ë¯¸ì ìš©">ë³µê·€ ì•ˆ í•¨ (í˜œíƒ ì—†ìŒ)</option>
            <option value="1.0" data-text="100% (ì „ì•¡ê°ë©´)">2026ë…„ 1ë¶„ê¸° ë³µê·€ (100% ê°ë©´)</option>
            <option value="0.8" data-text="80% ê°ë©´">2026ë…„ 2ë¶„ê¸° ë³µê·€ (80% ê°ë©´)</option>
            <option value="0.5" data-text="50% ê°ë©´">2026ë…„ í•˜ë°˜ê¸° ë³µê·€ (50% ê°ë©´)</option>
        </select>
    </div>

    <div class="section-title">3. í™˜í—¤ì§€(ì„ ë¬¼í™˜) ì„¤ì • <span class="badge">ì„ íƒ</span></div>
    <div class="full-width">
        <label>í™˜í—¤ì§€(ì„ ë¬¼í™˜ ë§¤ë„) ê¸ˆì•¡ (ë§Œì›)</label>
        <input type="number" id="hedgeAmount" value="0" placeholder="0">
        <div style="font-size:0.75rem; color:#888; margin-top:4px;">* í—¤ì§€ ê¸ˆì•¡ì˜ 5% ì¶”ê°€ ê³µì œ (ìµœëŒ€ 500ë§Œì› í•œë„)</div>
    </div>
    
    <button onclick="calculate()">ê³„ì‚° ê²°ê³¼ ë° ì‚°ì‹ ë³´ê¸°</button>

    <div class="result-box" id="resultBox">
        <div style="font-size:0.9rem; font-weight:bold; color:#0b7285;">ìµœì¢… ë‚©ë¶€í•  ì„¸ê¸ˆ</div>
        <div class="result-val" id="finalTax">0ì›</div>
        <div style="font-size:0.9rem; color:#495057;">
            (ê¸°ì¡´ ëŒ€ë¹„ <span id="totalSaved" style="font-weight:bold; color:#e03131;">0ì›</span> ì ˆì„¸)
        </div>
    </div>

    <div class="calc-detail" id="calcDetail">
        <div style="text-align:center; font-weight:bold; margin-bottom:15px; color:#333;">ğŸ§¾ ìƒì„¸ ê³„ì‚° ë‚´ì—­</div>
        
        <div class="calc-step">
            <span class="step-result" id="step1_result">0ì›</span>
            <span class="step-title">Step 1. ê³¼ì„¸í‘œì¤€ ì‚°ì¶œ</span>
            <span class="step-formula" id="step1_formula">ìˆ˜ìµ - ê¸°ë³¸ê³µì œ - í™˜í—¤ì§€ê³µì œ</span>
        </div>

        <div class="calc-step">
            <span class="step-result" id="step2_result">0ì›</span>
            <span class="step-title">Step 2. ì‚°ì¶œ ì„¸ì•¡ (22%)</span>
            <span class="step-formula" id="step2_formula">ê³¼ì„¸í‘œì¤€ Ã— 22%</span>
        </div>

        <div class="calc-step">
            <span class="step-result" id="step3_result">-0ì›</span>
            <span class="step-title">Step 3. RIA ì„¸ì•¡ ê°ë©´</span>
            <span class="step-formula" id="step3_formula">ì‚°ì¶œì„¸ì•¡ Ã— ê°ë©´ìœ¨</span>
        </div>

        <div class="calc-step" style="border-top: 2px solid #ddd; padding-top:10px;">
            <span class="step-result" id="step4_result" style="font-size:1.1rem; color:#e03131;">0ì›</span>
            <span class="step-title">Step 4. ìµœì¢… ë‚©ë¶€ ì„¸ì•¡</span>
            <span class="step-formula">ì‚°ì¶œì„¸ì•¡ - ì„¸ì•¡ê°ë©´</span>
        </div>
    </div>
    
    <div class="chart-area" id="chartArea">
        <canvas id="myChart"></canvas>
    </div>

    <div class="footer">
        <strong>[ì¶œì²˜: ê¸°íšì¬ì •ë¶€ '25.12.24 ë³´ë„ìë£Œ]</strong><br>
        1. RIA ê°ë©´: '26ë…„ 1ë¶„ê¸°(100%), 2ë¶„ê¸°(80%), í•˜ë°˜ê¸°(50%) ì°¨ë“± ì ìš©<br>
        2. í™˜í—¤ì§€ ê³µì œ: ì„ ë¬¼í™˜ ë§¤ë„ì•¡ì˜ 5% ì†Œë“ê³µì œ (ìµœëŒ€ 500ë§Œì›)<br>
        3. ê¸°ë³¸ê³µì œ: ì—° 250ë§Œì› ì ìš© ê°€ì •
    </div>
</div>

<script>
    let chartInstance = null;

    // ìˆ«ì í¬ë§·í„° (ì½¤ë§ˆ)
    const fmt = (num) => Math.round(num).toLocaleString();

    function calculate() {
        // 1. ì…ë ¥ê°’ ê°€ì ¸ì˜¤ê¸°
        const principal = Number(document.getElementById('principal').value) * 10000;
        const profit = Number(document.getElementById('profit').value) * 10000;
        
        const riaSelect = document.getElementById('riaTiming');
        const riaRate = Number(riaSelect.value); // 1.0, 0.8, 0.5, 0
        const riaText = riaSelect.options[riaSelect.selectedIndex].getAttribute('data-text');

        const hedgeAmt = Number(document.getElementById('hedgeAmount').value) * 10000;
        
        // 2. ê³µì œ ê³„ì‚°
        const basicDeduction = 2500000;
        // í™˜í—¤ì§€ ê³µì œ: min(í—¤ì§€ì•¡*5%, 500ë§Œì›) 
        const hedgeDeduction = Math.min(hedgeAmt * 0.05, 5000000);

        // --- ê³„ì‚° ë¡œì§ ---
        
        // [Step 1] ê³¼ì„¸í‘œì¤€
        let taxBase = Math.max(profit - basicDeduction - hedgeDeduction, 0);
        
        // [Step 2] ì‚°ì¶œì„¸ì•¡ (22%)
        let calculatedTax = taxBase * 0.22;

        // [Step 3] RIA ê°ë©´ì•¡ (ì„¸ì•¡ê°ë©´) [cite: 14, 15]
        let discountAmount = calculatedTax * riaRate;

        // [Step 4] ìµœì¢… ì„¸ì•¡
        let finalTax = Math.max(calculatedTax - discountAmount, 0);

        // [ë¹„êµìš©] ê¸°ì¡´ ë°©ì‹ ì„¸ê¸ˆ (ê¸°ë³¸ê³µì œë§Œ ì ìš© ì‹œ)
        let oldTaxBase = Math.max(profit - basicDeduction, 0);
        let oldTax = oldTaxBase * 0.22;
        let totalSaved = oldTax - finalTax;

        // --- í™”ë©´ í‘œì‹œ (ê²°ê³¼ ë°•ìŠ¤) ---
        document.getElementById('finalTax').innerText = fmt(finalTax) + "ì›";
        document.getElementById('totalSaved').innerText = fmt(totalSaved) + "ì›";
        
        // --- í™”ë©´ í‘œì‹œ (ìƒì„¸ ì‚°ì‹) ---
        // Step 1 í…ìŠ¤íŠ¸ êµ¬ì„±
        let step1_str = `${fmt(profit)} (ìˆ˜ìµ) - 250ë§Œ (ê¸°ë³¸ê³µì œ)`;
        if(hedgeDeduction > 0) step1_str += ` - ${fmt(hedgeDeduction)} (í™˜í—¤ì§€ê³µì œ)`;
        document.getElementById('step1_formula').innerText = step1_str;
        document.getElementById('step1_result').innerText = fmt(taxBase) + "ì›";

        // Step 2
        document.getElementById('step2_formula').innerText = `${fmt(taxBase)} Ã— 22% (ì§€ë°©ì„¸í¬í•¨)`;
        document.getElementById('step2_result').innerText = fmt(calculatedTax) + "ì›";

        // Step 3
        if(riaRate > 0) {
            document.getElementById('step3_formula').innerText = `${fmt(calculatedTax)} Ã— ${riaRate*100}% (${riaText})`;
            document.getElementById('step3_result').innerText = "-" + fmt(discountAmount) + "ì›";
        } else {
            document.getElementById('step3_formula').innerText = "RIA ê°ë©´ ë¯¸ì‹ ì²­";
            document.getElementById('step3_result').innerText = "0ì›";
        }

        // Step 4
        document.getElementById('step4_result').innerText = fmt(finalTax) + "ì›";

        // UI ë³´ì´ê¸°
        document.getElementById('resultBox').style.display = 'block';
        document.getElementById('calcDetail').style.display = 'block';
        document.getElementById('chartArea').style.display = 'block';

        // --- ì°¨íŠ¸ ì—…ë°ì´íŠ¸ ---
        updateChart(oldTax, finalTax, totalSaved);
    }

    function updateChart(oldTax, newTax, saved) {
        const ctx = document.getElementById('myChart');
        if(chartInstance) chartInstance.destroy();

        chartInstance = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['ê¸°ì¡´ ì„¸ê¸ˆ', 'RIA/í™˜í—¤ì§€ ì ìš©'],
                datasets: [{
                    label: 'ë‚©ë¶€ ì„¸ê¸ˆ',
                    data: [oldTax, newTax],
                    backgroundColor: ['#ced4da', '#e03131'],
                    order: 1
                },
                {
                    label: 'ì ˆì„¸(ì´ë“) ê¸ˆì•¡',
                    data: [0, saved],
                    backgroundColor: '#3bc9db',
                    type: 'bar',
                    order: 2,
                    skipNull: true
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: { stacked: true },
                    y: { stacked: true, beginAtZero: true }
                },
                plugins: {
                    tooltip: {
                        callbacks: {
                            label: (ctx) => ctx.dataset.label + ": " + fmt(ctx.raw) + "ì›"
                        }
                    },
                    legend: { position: 'bottom' }
                }
            }
        });
    }
</script>
</body>
</html>
